@page "/agents"
@rendermode InteractiveServer

@inject HttpClient Http
@inject ILoggerFactory LoggerFactory

<PageTitle>Agents</PageTitle>

<MudPaper Class="pa-4">
	<MudStack Row="true" AlignItems="AlignItems.Center" Class="mb-2">
		<MudBreadcrumbs Items="_breadcrumbs" Separator=">"></MudBreadcrumbs>
	</MudStack>
	<MudText Typo="Typo.h4">Agents</MudText>

	<MudText Class="mb-4">Manage AI agents and their instruction versions.</MudText>

	<MudButton Variant="Variant.Filled" Color="Color.Primary" Href="/agents/new" Class="mb-4">
		New Agent
	</MudButton>

	<div style="position: relative; min-height: 200px;">
		@if (_isLoading)
		{
			<div style="display: flex; justify-content: center; align-items: center; min-height: 200px;">
				<MudProgressCircular Indeterminate="true"/>
			</div>
		}

		@if (!_isLoading && !string.IsNullOrEmpty(_errorMessage))
		{
			<MudAlert Severity="Severity.Error">@_errorMessage</MudAlert>
		}

		@if (!_isLoading && string.IsNullOrEmpty(_errorMessage) && (_agents is null || _agents.Length == 0))
		{
			<MudText Class="mb-4">
				No agents yet.
				<MudLink Href="/agents/new">Create a new agent</MudLink>
			</MudText>
		}

		@if (!_isLoading && string.IsNullOrEmpty(_errorMessage) && _agents is not null && _agents.Length > 0)
		{
			<MudTable Items="_agents" Dense="true" Hover="true">
				<HeaderContent>
					<MudTh>Name</MudTh>
					<MudTh>Role</MudTh>
					<MudTh align="Align.Right">Actions</MudTh>
				</HeaderContent>
				<RowTemplate>
					<MudTd>
						<MudLink Href="@($"/agents/{context.Id}")">@context.Name</MudLink>
					</MudTd>
					<MudTd>@context.Role</MudTd>
					<MudTd align="Align.Right">
						<MudTooltip Text="View Details">
							<MudIconButton Icon="@Icons.Material.Filled.Visibility"
							               Color="Color.Primary"
							               Size="Size.Small"
							               Href="@($"/agents/{context.Id}")"/>
						</MudTooltip>
						<MudTooltip Text="Improve Prompt">
							<MudIconButton Icon="@Icons.Material.Filled.AutoAwesome"
							               Color="Color.Secondary"
							               Size="Size.Small"
							               Href="@($"/agents/{context.Id}/improve")"/>
						</MudTooltip>
						<MudTooltip Text="Edit Agent">
							<MudIconButton Icon="@Icons.Material.Filled.Edit"
							               Color="Color.Default"
							               Size="Size.Small"
							               Href="@($"/agents/{context.Id}/edit")"/>
						</MudTooltip>
					</MudTd>
				</RowTemplate>
			</MudTable>
		}
	</div>
</MudPaper>
