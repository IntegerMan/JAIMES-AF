@page "/agents/{agentId}/instruction-versions"
@rendermode InteractiveServer

@inject HttpClient Http
@inject ILoggerFactory LoggerFactory
@inject NavigationManager Navigation

<PageTitle>Instruction Versions</PageTitle>

<MudPaper Class="pa-4">
	<MudText Typo="Typo.h4">Instruction Versions for Agent: @_agentId</MudText>

	<MudButton Variant="Variant.Filled" Color="Color.Primary" Href="@($"/agents/{_agentId}/instruction-versions/new")" Class="mb-4">
		New Instruction Version
	</MudButton>

	<div style="position: relative; min-height: 200px;">
		@if (_isLoading)
		{
			<div style="display: flex; justify-content: center; align-items: center; min-height: 200px;">
				<MudProgressCircular Indeterminate="true"/>
			</div>
		}

		@if (!_isLoading && !string.IsNullOrEmpty(_errorMessage))
		{
			<MudAlert Severity="Severity.Error">@_errorMessage</MudAlert>
		}

		@if (!_isLoading && string.IsNullOrEmpty(_errorMessage) && (_versions is null || _versions.Length == 0))
		{
			<MudText Class="mb-4">No instruction versions yet.
				<MudLink Href="@($"/agents/{_agentId}/instruction-versions/new")">Create a new version</MudLink>
			</MudText>
		}

		@if (!_isLoading && string.IsNullOrEmpty(_errorMessage) && _versions is not null && _versions.Length > 0)
		{
			<MudTable Items="_versions" Dense="true" Hover="true">
				<HeaderContent>
					<MudTh>Version</MudTh>
					<MudTh>Created</MudTh>
					<MudTh>Active</MudTh>
					<MudTh>Instructions Preview</MudTh>
				</HeaderContent>
				<RowTemplate>
					<MudTd>@context.VersionNumber</MudTd>
					<MudTd>@context.CreatedAt.ToString("yyyy-MM-dd")</MudTd>
					<MudTd>@(context.IsActive ? "Yes" : "No")</MudTd>
					<MudTd>
						<MudTooltip Text="@context.Instructions">
							<span>@(context.Instructions.Length > 50 ? context.Instructions.Substring(0, 50) + "..." : context.Instructions)</span>
						</MudTooltip>
					</MudTd>
				</RowTemplate>
			</MudTable>
		}
	</div>
</MudPaper>
