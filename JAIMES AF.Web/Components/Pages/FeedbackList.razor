@page "/admin/feedback"
@using MattEland.Jaimes.Web.Components.Shared
@using MudBlazor
@inject NavigationManager NavigationManager
@rendermode InteractiveServer

<PageTitle>Feedback Reports</PageTitle>

<MudContainer MaxWidth="MaxWidth.ExtraLarge" Class="mt-4">
    <MudStack Row="true" AlignItems="AlignItems.Center" Class="mb-2">
        <MudBreadcrumbs Items="_breadcrumbs" Separator=">"></MudBreadcrumbs>
    </MudStack>
    <MudText Typo="Typo.h4" Class="mb-2">Feedback Reports</MudText>

    <AdminFilters ToolName="@ToolName"
                  IsPositive="@IsPositive"
                  AgentVersion="@AgentId"
                  OnClearFilters="ClearFilters"/>

    <FeedbackGrid AgentId="@AgentId"
                  InstructionVersionId="@InstructionVersionId"
                  ToolName="@ToolName"
                  IsPositive="@IsPositive"
                  GameId="@GameId"/>
</MudContainer>

@code {

    /// <summary>
    /// Optional tool name to filter feedback by.
    /// </summary>
    [Parameter]
    [SupplyParameterFromQuery]
    public string? ToolName { get; set; }

    /// <summary>
    /// Optional filter for positive (true) or negative (false) feedback.
    /// </summary>
    [Parameter]
    [SupplyParameterFromQuery]
    public bool? IsPositive { get; set; }

    /// <summary>
    /// Optional agent ID to filter results.
    /// </summary>
    [Parameter]
    [SupplyParameterFromQuery]
    public string? AgentId { get; set; }

    /// <summary>
    /// Optional instruction version ID to filter results.
    /// </summary>
    [Parameter]
    [SupplyParameterFromQuery]
    public int? InstructionVersionId { get; set; }

    /// <summary>
    /// Optional game ID to filter results.
    /// </summary>
    [Parameter]
    [SupplyParameterFromQuery]
    public Guid? GameId { get; set; }

    private List<BreadcrumbItem> _breadcrumbs = new();

    protected override void OnInitialized()
    {
        _breadcrumbs = new List<BreadcrumbItem>
        {
            new BreadcrumbItem("Home", href: "/"),
            new BreadcrumbItem("Admin", href: "/admin"),
            new BreadcrumbItem("Feedback", href: null, disabled: true)
        };
    }

    private void ClearFilters()
    {
        NavigationManager.NavigateTo("/admin/feedback");
    }

}
