@page "/scenarios/new"
@rendermode InteractiveServer

<PageTitle>Create New Scenario</PageTitle>

<MudContainer MaxWidth="MaxWidth.Medium" Class="mt-4">
	<FormPageHeader Title="Create New Scenario"
	                Icon="@Icons.Material.Filled.TheaterComedy"
	                Theme="FormPageHeader.HeroTheme.Secondary"
	                Subtitle="Design a new adventure" />

	<MudPaper Class="pa-6" Elevation="2">
        <MudStack Row="true" AlignItems="AlignItems.Center" Class="mb-4">
            <MudBreadcrumbs Items="_breadcrumbs" Separator=">"></MudBreadcrumbs>
        </MudStack>

		@if (_isLoading)
		{
			<MudProgressCircular Indeterminate="true" Class="my-4"/>
		}
		else if (!string.IsNullOrEmpty(_errorMessage))
		{
			<MudAlert Severity="Severity.Error" Class="mb-4">@_errorMessage</MudAlert>
		}

		@if (!_isLoading)
		{
			<MudForm>
				<MudTextField @bind-Value="_scenarioId"
				              Label="Scenario ID"
				              Variant="Variant.Outlined"
				              Class="mb-4"
				              Disabled="_isSaving"
				              Required="true"
				              RequiredError="Scenario ID is required"
				              HelperText="A unique identifier for this scenario (e.g., 'myScenario')"/>

				<MudSelect T="string"
				           @bind-Value="_selectedRulesetId"
				           Label="Ruleset"
				           Variant="Variant.Outlined"
				           Class="mb-4"
				           Disabled="_isSaving"
				           Required="true"
				           RequiredError="Please select a ruleset">
					@foreach (RulesetInfoResponse ruleset in _rulesets)
					{
						<MudSelectItem Value="@ruleset.Id">@ruleset.Name</MudSelectItem>
					}
				</MudSelect>

				<MudTextField @bind-Value="_name"
				              Label="Name"
				              Variant="Variant.Outlined"
				              Class="mb-4"
				              Disabled="_isSaving"
				              Required="true"
				              RequiredError="Name is required"/>

				<MudTextField @bind-Value="_description"
				              Label="Description"
				              Variant="Variant.Outlined"
				              Class="mb-4"
				              Disabled="_isSaving"
				              Lines="2"/>

				<MudTextField @bind-Value="_initialGreeting"
				              Label="Initial Greeting"
				              Variant="Variant.Outlined"
				              Class="mb-4"
				              Disabled="_isSaving"
				              Lines="5"
				              HelperText="The initial message shown to players when starting a new game with this scenario (optional)"/>

				<FormActionButtons PrimaryText="Create Scenario"
				                   PrimaryColor="Color.Secondary"
				                   PrimaryIcon="@Icons.Material.Filled.Add"
				                   OnPrimary="CreateScenarioAsync"
				                   PrimaryDisabled="@(!IsFormValid())"
				                   IsSaving="_isSaving"
				                   SavingText="Creating..."
				                   CancelHref="/scenarios" />
			</MudForm>
		}
	</MudPaper>
</MudContainer>

