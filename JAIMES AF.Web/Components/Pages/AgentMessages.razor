@page "/admin/messages"
@rendermode InteractiveServer

@inject NavigationManager NavigationManager

<PageTitle>Agent Messages</PageTitle>

<MudContainer MaxWidth="MaxWidth.Large" Class="pa-4">
    <MudStack Row="true" AlignItems="AlignItems.Center" Class="mb-2">
        <MudBreadcrumbs Items="_breadcrumbs" Separator=">"></MudBreadcrumbs>
    </MudStack>

    <div class="agent-hero pa-3 mb-4" style="background: linear-gradient(135deg, rgba(67, 97, 238, 0.1) 0%, rgba(76, 201, 240, 0.1) 100%); 
        border-radius: 16px; border: 1px solid rgba(67, 97, 238, 0.2);">
        <MudStack Row="true" AlignItems="AlignItems.Center" Spacing="3">
            <div class="icon-badge icon-badge-secondary">
                <MudIcon Icon="@Icons.Material.Filled.Chat" Style="color: white; font-size: 1.5rem;" />
            </div>
            <MudStack Spacing="0">
                <MudText Typo="Typo.h5" Style="font-weight: 600; color: #4361EE;">Agent Messages</MudText>
                <MudText Typo="Typo.caption" Class="text-muted">
                    @if (string.IsNullOrEmpty(AgentId))
                    {
                        <span>Viewing all messages</span>
                    }
                    else
                    {
                        <span>Viewing messages for @_displayAgentName @(VersionId.HasValue ? $" version {VersionId}" :
                        "")</span>
                    }
                </MudText>
            </MudStack>
        </MudStack>
    </div>

    <div class="glass-card pa-4">
        <MattEland.Jaimes.Web.Components.Agents.AgentMessagesList AgentId="@AgentId" VersionId="@VersionId" />
    </div>
</MudContainer>

@code {
    [Parameter, SupplyParameterFromQuery] public string? AgentId { get; set; }
    [Parameter, SupplyParameterFromQuery] public int? VersionId { get; set; }

    private List<BreadcrumbItem> _breadcrumbs = new();
    private string? _displayAgentName;

    protected override void OnParametersSet()
    {
        _displayAgentName = AgentId;

        _breadcrumbs = new List<BreadcrumbItem>
{
new BreadcrumbItem("Home", href: "/"),
new BreadcrumbItem("Admin", href: "/admin"),
new BreadcrumbItem("Agents", href: "/agents"),
};

        if (!string.IsNullOrEmpty(AgentId))
        {
            _breadcrumbs.Add(new BreadcrumbItem(AgentId, href: $"/agents/{AgentId}"));
        }

        _breadcrumbs.Add(new BreadcrumbItem("Messages", href: null, disabled: true));
    }
}
