@page "/"

<PageTitle>JAIMES AF - AI Game Master</PageTitle>

@inject HttpClient Http
@inject ILoggerFactory LoggerFactory

<MudContainer MaxWidth="MaxWidth.Large" Class="pa-4">

	@* Premium Hero Section with Animated Gradient *@
	<div class="hero-premium pa-4 mb-5" style="min-height: 160px;">
		@* Floating Particles *@
		<div class="hero-particles">
			<div class="particle"></div>
			<div class="particle"></div>
			<div class="particle"></div>
			<div class="particle"></div>
			<div class="particle"></div>
			<div class="particle"></div>
		</div>

		<MudGrid Style="position: relative; z-index: 1;">
			<MudItem xs="12" md="12">
				<MudStack Spacing="2">
					<h1 class="hero-title">JAIMES AF</h1>
					<p class="hero-subtitle">Join AI in Making Epic Stories — Agent Framework</p>
				</MudStack>
				<MudStack Row="true" Spacing="2" AlignItems="AlignItems.Center" Class="mt-5">
					<MudButton Variant="Variant.Filled" Size="Size.Large" Href="/games/new"
						StartIcon="@Icons.Material.Filled.PlayArrow" Class="btn-hero-primary">
						Start New Game
					</MudButton>
					@if (_lastPlayedGame != null)
					{
						<MudButton Variant="Variant.Outlined" Size="Size.Large" Href="@($"/games/{_lastPlayedGame.GameId}")"
							StartIcon="@Icons.Material.Filled.Restore" Class="btn-hero-secondary">
							Continue: @_lastPlayedGame.Title
						</MudButton>
					}
				</MudStack>
			</MudItem>

			<MudLink Href="/admin" Class="admin-link-hero pa-2">
				<MudStack Row="true" Spacing="1" AlignItems="AlignItems.Center">
					<MudIcon Icon="@Icons.Material.Filled.AdminPanelSettings" Size="Size.Small" />
					<MudText Typo="Typo.button" Style="font-size: 0.75rem; font-weight: 600;">Admin Portal</MudText>
				</MudStack>
			</MudLink>
		</MudGrid>
	</div>

	@* Main Content Grid - Widened left column for better use of large screens *@
	<MudGrid Spacing="4">
		@* Left Column: Quick Actions & About *@
		<MudItem xs="12" md="8">
			<MudText Typo="Typo.overline" Class="mb-3" Style="letter-spacing: 1.5px; color: #7B2CBF; font-weight: 600;">
				GET STARTED
			</MudText>
			<MudGrid Spacing="3">
				@* Games Card *@
				<MudItem xs="12" sm="4">
					<MudLink Href="/games" Underline="Underline.None" Style="display: block;">
						<div class="glass-card pa-4" style="cursor: pointer; height: 100%;">
							<MudStack AlignItems="AlignItems.Center" Spacing="2">
								<div class="icon-badge icon-badge-primary">
									<MudIcon Icon="@Icons.Material.Filled.SportsEsports"
										Style="color: white; font-size: 1.5rem;" />
								</div>
								<MudText Typo="Typo.subtitle1" Style="font-weight: 600;">Games</MudText>
								<MudText Typo="Typo.caption" Class="text-muted" Align="Align.Center">Play adventures
								</MudText>
							</MudStack>
						</div>
					</MudLink>
				</MudItem>

				@* Scenarios Card *@
				<MudItem xs="12" sm="4">
					<MudLink Href="/scenarios" Underline="Underline.None" Style="display: block;">
						<div class="glass-card pa-4" style="cursor: pointer; height: 100%;">
							<MudStack AlignItems="AlignItems.Center" Spacing="2">
								<div class="icon-badge icon-badge-secondary">
									<MudIcon Icon="@Icons.Material.Filled.MenuBook"
										Style="color: white; font-size: 1.5rem;" />
								</div>
								<MudText Typo="Typo.subtitle1" Style="font-weight: 600;">Scenarios</MudText>
								<MudText Typo="Typo.caption" Class="text-muted" Align="Align.Center">Story seeds
								</MudText>
							</MudStack>
						</div>
					</MudLink>
				</MudItem>

				@* Characters Card *@
				<MudItem xs="12" sm="4">
					<MudLink Href="/players" Underline="Underline.None" Style="display: block;">
						<div class="glass-card pa-4" style="cursor: pointer; height: 100%;">
							<MudStack AlignItems="AlignItems.Center" Spacing="2">
								<div class="icon-badge icon-badge-info">
									<MudIcon Icon="@Icons.Material.Filled.Person"
										Style="color: white; font-size: 1.5rem;" />
								</div>
								<MudText Typo="Typo.subtitle1" Style="font-weight: 600;">Characters</MudText>
								<MudText Typo="Typo.caption" Class="text-muted" Align="Align.Center">Your heroes
								</MudText>
							</MudStack>
						</div>
					</MudLink>
				</MudItem>
			</MudGrid>

			@* Unified About + Features Section *@
			<div class="about-section pa-4 mt-4">
				<MudStack Spacing="3">
					<MudStack Row="true" AlignItems="AlignItems.Center" Spacing="2">
						<MudIcon Icon="@Icons.Material.Filled.AutoAwesome" Color="Color.Primary" />
						<MudText Typo="Typo.subtitle1" Style="font-weight: 600; color: #7B2CBF;">About JAIMES AF
						</MudText>
					</MudStack>
					<MudText Typo="Typo.body2" Style="line-height: 1.7; color: #444;">
						JAIMES AF is an AI-powered single-player roleplaying platform built on Microsoft's Agent
						Framework.
						It uses Azure OpenAI to create an intelligent Game Master that crafts immersive narratives,
						remembers your story context, and adapts dynamically to your choices.
					</MudText>

					@* Feature Pills - Integrated within About *@
					<MudStack Row="true" Style="flex-wrap: wrap; gap: 12px;" Class="mt-2">
						<MudLink Href="/scenarios" Underline="Underline.None">
							<span class="feature-pill">
								<MudIcon Icon="@Icons.Material.Filled.ElectricBolt" Style="color: #7B2CBF;"
									Size="Size.Small" />
								AI Storytelling
							</span>
						</MudLink>
						<MudLink Href="/tools/location-lookup" Underline="Underline.None">
							<span class="feature-pill">
								<MudIcon Icon="@Icons.Material.Filled.Public" Style="color: #4361EE;"
									Size="Size.Small" />
								Dynamic Worlds
							</span>
						</MudLink>
						<MudLink Href="/admin/sentiments" Underline="Underline.None">
							<span class="feature-pill">
								<MudIcon Icon="@Icons.Material.Filled.AutoAwesome" Style="color: #4CC9F0;"
									Size="Size.Small" />
								Adaptive Narratives
							</span>
						</MudLink>
						<MudLink Href="/agents" Underline="Underline.None">
							<span class="feature-pill">
								<MudIcon Icon="@Icons.Material.Filled.SmartToy" Style="color: #06D6A0;"
									Size="Size.Small" />
								Agent Framework
							</span>
						</MudLink>
						<MudLink Href="/admin/rag-collections" Underline="Underline.None">
							<span class="feature-pill">
								<MudIcon Icon="@Icons.Material.Filled.Storage" Style="color: #F15BB5;"
									Size="Size.Small" />
								Qdrant Vector Storage
							</span>
						</MudLink>
						<MudLink Href="/admin/classification-models" Underline="Underline.None">
							<span class="feature-pill">
								<MudIcon Icon="@Icons.Material.Filled.Psychology" Style="color: #EF476F;"
									Size="Size.Small" />
								ML.NET
							</span>
						</MudLink>
					</MudStack>
				</MudStack>
			</div>
		</MudItem>

		@* Right Column: Expanded Stats Dashboard *@
		<MudItem xs="12" md="4">
			<MudText Typo="Typo.overline" Class="mb-3" Style="letter-spacing: 1.5px; color: #7B2CBF; font-weight: 600;">
				STATS DASHBOARD
			</MudText>

			<MudPaper Elevation="0" Class="pa-2"
				Style="background: linear-gradient(to bottom right, #f8f9fa, #ffffff); border-radius: 16px; border: 1px solid #e8e8e8;">
				<MudGrid Spacing="2">
					@* Content Stats *@
					<MudItem xs="6">
						<MudLink Href="/games" Class="stat-card-link">
							<div class="stat-card stat-card-primary">
								<MudStack Row="true" AlignItems="AlignItems.Center" Spacing="2">
									<MudIcon Icon="@Icons.Material.Filled.SportsEsports" Color="Color.Primary" />
									<MudStack Spacing="0">
										<MudText Typo="Typo.caption" Class="text-muted">Active Games</MudText>
										<span class="stat-value">@_gamesCount</span>
									</MudStack>
								</MudStack>
							</div>
						</MudLink>
					</MudItem>

					<MudItem xs="6">
						<MudLink Href="/scenarios" Class="stat-card-link">
							<div class="stat-card stat-card-secondary">
								<MudStack Row="true" AlignItems="AlignItems.Center" Spacing="2">
									<MudIcon Icon="@Icons.Material.Filled.MenuBook" Color="Color.Secondary" />
									<MudStack Spacing="0">
										<MudText Typo="Typo.caption" Class="text-muted">Scenarios</MudText>
										<span class="stat-value">@_scenariosCount</span>
									</MudStack>
								</MudStack>
							</div>
						</MudLink>
					</MudItem>

					<MudItem xs="6">
						<MudLink Href="/admin/messages" Class="stat-card-link">
							<div class="stat-card stat-card-secondary">
								<MudStack Row="true" AlignItems="AlignItems.Center" Spacing="2">
									<MudIcon Icon="@Icons.Material.Filled.Forum" Color="Color.Secondary" />
									<MudStack Spacing="0">
										<MudText Typo="Typo.caption" Class="text-muted">Messages</MudText>
										<span class="stat-value">@_messagesCount</span>
									</MudStack>
								</MudStack>
							</div>
						</MudLink>
					</MudItem>

					<MudItem xs="6">
						<MudLink Href="/rulesets" Class="stat-card-link">
							<div class="stat-card stat-card-accent">
								<MudStack Row="true" AlignItems="AlignItems.Center" Spacing="2">
									<MudIcon Icon="@Icons.Material.Filled.AutoStories" Color="Color.Success" />
									<MudStack Spacing="0">
										<MudText Typo="Typo.caption" Class="text-muted">Systems / Sources</MudText>
										<span class="stat-value-compact">@_rulesetsCount <span
												class="stat-separator">•</span> @_sourcebooksCount</span>
									</MudStack>
								</MudStack>
							</div>
						</MudLink>
					</MudItem>
				</MudGrid>

				<MudDivider Class="my-2" />

				@* Platform Stats *@
				<MudText Typo="Typo.caption" Class="text-muted mb-2" Style="font-weight: 600; letter-spacing: 0.5px;">
					PLATFORM</MudText>
				<MudGrid Spacing="2">
					<MudItem xs="6">
						<MudLink Href="/agents" Class="stat-card-link">
							<div class="stat-card stat-card-platform">
								<MudStack Row="true" AlignItems="AlignItems.Center" Spacing="2">
									<MudIcon Icon="@Icons.Material.Filled.SmartToy" Style="color: #9D4EDD;" />
									<MudStack Spacing="0">
										<MudText Typo="Typo.caption" Class="text-muted">Agents / Versions</MudText>
										<span class="stat-value-compact">@_agentsCount <span
												class="stat-separator">•</span> @_versionsCount</span>
									</MudStack>
								</MudStack>
							</div>
						</MudLink>
					</MudItem>

					<MudItem xs="6">
						<MudLink Href="/admin/classification-models" Class="stat-card-link">
							<div class="stat-card stat-card-mlnet">
								<MudStack Row="true" AlignItems="AlignItems.Center" Spacing="2">
									<MudIcon Icon="@Icons.Material.Filled.Psychology" Style="color: #EF476F;" />
									<MudStack Spacing="0">
										<MudText Typo="Typo.caption" Class="text-muted">ML Models</MudText>
										<span class="stat-value">@_mlModelsCount</span>
									</MudStack>
								</MudStack>
							</div>
						</MudLink>
					</MudItem>
				</MudGrid>

				<MudDivider Class="my-2" />

				@* AI Metrics *@
				<MudText Typo="Typo.caption" Class="text-muted mb-2" Style="font-weight: 600; letter-spacing: 0.5px;">AI
					QUALITY</MudText>
				<MudGrid Spacing="2">
					<MudItem xs="6">
						<MudLink Href="/admin/test-cases" Class="stat-card-link">
							<div class="stat-card stat-card-warning">
								<MudStack Row="true" AlignItems="AlignItems.Center" Spacing="2">
									<MudIcon Icon="@Icons.Material.Filled.Checklist" Style="color: #F59E0B;" />
									<MudStack Spacing="0">
										<MudText Typo="Typo.caption" Class="text-muted">Test Cases / Reports</MudText>
										<span class="stat-value-compact">@_testCasesCount <span
												class="stat-separator">•</span> @_testReportsCount</span>
									</MudStack>
								</MudStack>
							</div>
						</MudLink>
					</MudItem>

					<MudItem xs="6">
						<MudLink Href="/admin/sentiments" Class="stat-card-link">
							<div class="stat-card stat-card-error">
								<MudStack Row="true" AlignItems="AlignItems.Center" Spacing="2">
									<MudIcon Icon="@Icons.Material.Filled.SentimentSatisfied" Style="color: #EF476F;" />
									<MudStack Spacing="0">
										<MudText Typo="Typo.caption" Class="text-muted">Sentiments</MudText>
										<span class="stat-value">@_sentimentCount</span>
									</MudStack>
								</MudStack>
							</div>
						</MudLink>
					</MudItem>

					<MudItem xs="6">
						<MudLink Href="/admin/metrics" Class="stat-card-link">
							<div class="stat-card stat-card-secondary">
								<MudStack Row="true" AlignItems="AlignItems.Center" Spacing="2">
									<MudIcon Icon="@Icons.Material.Filled.PieChart" Color="Color.Secondary" />
									<MudStack Spacing="0">
										<MudText Typo="Typo.caption" Class="text-muted">Evaluations</MudText>
										<span class="stat-value">@_metricsCount</span>
									</MudStack>
								</MudStack>
							</div>
						</MudLink>
					</MudItem>

					<MudItem xs="6">
						<MudLink Href="/admin/feedback" Class="stat-card-link">
							<div class="stat-card stat-card-primary">
								<MudStack Row="true" AlignItems="AlignItems.Center" Spacing="2">
									<MudIcon Icon="@Icons.Material.Filled.ThumbUp" Color="Color.Primary" />
									<MudStack Spacing="0">
										<MudText Typo="Typo.caption" Class="text-muted">Feedback</MudText>
										<span class="stat-value">@_feedbackCount</span>
									</MudStack>
								</MudStack>
							</div>
						</MudLink>
					</MudItem>
				</MudGrid>
			</MudPaper>
		</MudItem>
	</MudGrid>

</MudContainer>

@code {
	private GameInfoResponse? _lastPlayedGame;
	private int _gamesCount;
	private int _scenariosCount;
	private int _playersCount;
	private int _rulesetsCount;
	private int _agentsCount;
	private int _versionsCount;
	private int _messagesCount;
	private int _mlModelsCount;
	private int _sentimentCount;
	private int _feedbackCount;
	private int _metricsCount;
	private int _testCasesCount;
	private int _testReportsCount;
	private int _sourcebooksCount;

	protected override async Task OnInitializedAsync()
	{
		var logger = LoggerFactory.CreateLogger("Home");

		// Fetch dashboard stats and latest game in parallel
		var dashboardTask = Http.GetFromJsonAsync<DashboardStatsResponse>("/admin/dashboard/stats");
		var latestGameTask = Http.GetAsync("/games/latest");

		try
		{
			await Task.WhenAll(dashboardTask, latestGameTask);

			var stats = dashboardTask.Result;
			if (stats != null)
			{
				_gamesCount = stats.GamesCount;
				_scenariosCount = stats.ScenariosCount;
				_playersCount = stats.PlayersCount;
				_rulesetsCount = stats.RulesetsCount;
				_agentsCount = stats.AgentsCount;
				_versionsCount = stats.VersionsCount;
				_messagesCount = stats.MessagesCount;
				_mlModelsCount = stats.MlModelsCount;
				_sentimentCount = stats.SentimentsCount;
				_feedbackCount = stats.FeedbackCount;
				_metricsCount = stats.EvaluationsCount;
				_testCasesCount = stats.TestCasesCount;
				_testReportsCount = stats.TestReportsCount;
				_sourcebooksCount = stats.SourcebooksCount;
			}

			if (latestGameTask.Result.IsSuccessStatusCode)
			{
				_lastPlayedGame = await latestGameTask.Result.Content.ReadFromJsonAsync<GameInfoResponse>();
			}
		}
		catch (Exception ex)
		{
			logger.LogError(ex, "Failed to load home page data");
		}
	}
}
