@page "/games/new"
@rendermode InteractiveServer

<PageTitle>Create New Game</PageTitle>

<MudContainer MaxWidth="MaxWidth.Medium" Class="mt-4">
	<FormPageHeader Title="Create New Game"
	                Icon="@Icons.Material.Filled.SportsEsports"
	                Theme="FormPageHeader.HeroTheme.Primary"
	                Subtitle="Start a new game session" />

	<MudPaper Class="pa-6" Elevation="2">
		<MudStack Row="true" AlignItems="AlignItems.Center" Class="mb-4">
			<MudBreadcrumbs Items="_breadcrumbs" Separator=">"></MudBreadcrumbs>
		</MudStack>

		@if (_isLoading)
		{
			<MudProgressCircular Indeterminate="true" Class="my-4"/>
		}
		else if (!string.IsNullOrEmpty(_errorMessage))
		{
			<MudAlert Severity="Severity.Error" Class="mb-4">@_errorMessage</MudAlert>
		}

		@if (!_isLoading)
		{
			<MudForm>
				<MudTextField @bind-Value="_title"
				              Label="Game Title (Optional)"
				              Variant="Variant.Outlined"
				              Class="mb-4"
				              Disabled="_isCreating"/>

				<MudSelect T="string"
				           @bind-Value="_selectedScenarioId"
				           Label="Scenario"
				           Variant="Variant.Outlined"
				           Class="mb-4"
				           Disabled="_isCreating"
				           Required="true"
				           RequiredError="Please select a scenario">
					@foreach (ScenarioInfoResponse scenario in _scenarios)
					{
						<MudSelectItem Value="@scenario.Id">@GetScenarioDisplayName(scenario)</MudSelectItem>
					}
				</MudSelect>

				<MudSelect T="string"
				           @bind-Value="_selectedPlayerId"
				           Label="Player"
				           Variant="Variant.Outlined"
				           Class="mb-4"
				           Disabled="_isCreating"
				           Required="true"
				           RequiredError="Please select a player">
					@foreach (PlayerInfoResponse player in _players)
					{
						<MudSelectItem Value="@player.Id">@player.Name</MudSelectItem>
					}
				</MudSelect>

				<div class="d-flex gap-2 mt-4">
					<MudButton Variant="Variant.Filled"
					           Color="Color.Primary"
					           OnClick="CreateGameAsync"
					           Disabled="_isCreating || string.IsNullOrEmpty(_selectedScenarioId) || string.IsNullOrEmpty(_selectedPlayerId)"
					           StartIcon="@Icons.Material.Filled.Add">
						@if (_isCreating)
						{
							<MudProgressCircular Class="ms-n1" Size="Size.Small" Indeterminate="true"/>
							<span class="ms-2">Creating...</span>
						}
						else
						{
							<span>Create Game</span>
						}
					</MudButton>

					<MudButton Variant="Variant.Text"
					           Color="Color.Default"
					           Href="/games"
					           Disabled="_isCreating">
						Cancel
					</MudButton>
				</div>
			</MudForm>
		}
	</MudPaper>
</MudContainer>


