@page "/tools/location-management"
@rendermode InteractiveServer

<PageTitle>Location Management Test</PageTitle>

<MudContainer MaxWidth="MaxWidth.ExtraLarge" Class="pa-4">
	<MudStack Row="true" AlignItems="AlignItems.Center" Class="mb-2">
		<MudBreadcrumbs Items="_breadcrumbs" Separator=">"></MudBreadcrumbs>
	</MudStack>
	<MudPaper Class="pa-8" Elevation="2">
		<MudText Typo="Typo.h3" GutterBottom="true" Class="mb-2">Location Management Test</MudText>
		<MudText Typo="Typo.subtitle1" GutterBottom="true" Class="mb-6 text-muted">Test the LocationManagementTool functionality
		</MudText>

		<MudText Typo="Typo.body1" Class="mb-6" Style="line-height: 1.75;">
			Test creating/updating locations, adding events, and linking nearby locations. This page simulates the LocationManagementTool that AI agents use.
		</MudText>

		<MudDivider Class="my-6"/>

		<MudPaper Class="pa-4" Elevation="1">
			<MudText Typo="Typo.h6" GutterBottom="true" Class="mb-4">View Game Locations</MudText>

			<MudSelect @bind-Value="_selectedGameId"
			           Label="Game"
			           Variant="Variant.Outlined"
			           Class="mb-4"
			           FullWidth="true"
			           HelperText="Select a game to test">
				<MudSelectItem Value="@((Guid?) null)">Select a game...</MudSelectItem>
				@foreach (GameInfoResponse game in _games)
				{
					<MudSelectItem Value="@((Guid?) game.GameId)">@FormatGameDisplay(game)</MudSelectItem>
				}
			</MudSelect>

			@if (_selectedGameId.HasValue)
			{
				<MudButton Variant="Variant.Filled"
				           Color="Color.Primary"
				           OnClick="RefreshLocationsAsync"
				           Disabled="@_isLoading"
				           Class="mb-4">
					@if (_isLoading)
					{
						<MudProgressCircular Size="Size.Small" Indeterminate="true" Class="me-2"/>
					}
					Refresh Locations
				</MudButton>

				@if (_locations is { Length: > 0 })
				{
					<MudTable Items="_locations" Hover="true" Class="mb-4">
						<HeaderContent>
							<MudTh>Name</MudTh>
							<MudTh>Description</MudTh>
							<MudTh>Events</MudTh>
							<MudTh>Nearby</MudTh>
						</HeaderContent>
						<RowTemplate>
							<MudTd>@context.Name</MudTd>
							<MudTd>@(context.Description.Length > 50 ? context.Description[..50] + "..." : context.Description)</MudTd>
							<MudTd>@context.EventCount</MudTd>
							<MudTd>@context.NearbyLocationCount</MudTd>
						</RowTemplate>
					</MudTable>
				}
				else
				{
					<MudAlert Severity="Severity.Info" Class="mb-4">No locations found for this game.</MudAlert>
				}
			}
		</MudPaper>

		@if (!string.IsNullOrEmpty(_errorMessage))
		{
			<MudAlert Severity="Severity.Error" Class="mt-4">@_errorMessage</MudAlert>
		}

		@if (!string.IsNullOrEmpty(_successMessage))
		{
			<MudAlert Severity="Severity.Success" Class="mt-4">@_successMessage</MudAlert>
		}
	</MudPaper>
</MudContainer>
