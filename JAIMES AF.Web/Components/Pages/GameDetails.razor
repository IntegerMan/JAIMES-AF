@page "/games/{gameId:guid}"

@using System.Net.Http.Json
@using MudBlazor
@using MattEland.Jaimes.ServiceDefinitions.Responses

@inject HttpClient Http
@inject ILoggerFactory LoggerFactory

<PageTitle>Game Details</PageTitle>

<MudPaper Class="pa-4">
 <MudText Typo="Typo.h5">Game details (stub)</MudText>

 @if (isLoading)
 {
 <MudProgressCircular Indeterminate="true" Class="my-4" />
 }
 else if (!string.IsNullOrEmpty(errorMessage))
 {
 <MudAlert Severity="Severity.Error">@errorMessage</MudAlert>
 }
 else if (game is null)
 {
 <MudText>(No game loaded)</MudText>
 }
 else
 {
 <MudList T="string" Dense="true">
 <MudListItem T="string"> <b>Game ID:</b> @game.GameId</MudListItem>
 <MudListItem T="string"> <b>Scenario:</b> @game.ScenarioName (@game.ScenarioId)</MudListItem>
 <MudListItem T="string"> <b>Player:</b> @game.PlayerName (@game.PlayerId)</MudListItem>
 <MudListItem T="string"> <b>Ruleset:</b> @game.RulesetName (@game.RulesetId)</MudListItem>
 </MudList>
 }
</MudPaper>

@code {
 [Parameter]
 public Guid GameId { get; set; }

 private GameInfoResponse? game;
 private bool isLoading = true;
 private string? errorMessage;

 protected override async Task OnInitializedAsync()
 {
 await LoadGameAsync();
 }

 private async Task LoadGameAsync()
 {
 isLoading = true;
 errorMessage = null;
 try
 {
 var resp = await Http.GetFromJsonAsync<ListGamesResponse>("/games");
 game = resp?.Games?.FirstOrDefault(g => g.GameId == GameId);
 if (game == null)
 {
 game = new GameInfoResponse { GameId = GameId, ScenarioId = "unknown", ScenarioName = "(Unknown)", RulesetId = "unknown", RulesetName = "(Unknown)", PlayerId = "unknown", PlayerName = "(Unknown)" };
 }
 }
 catch (Exception ex)
 {
 LoggerFactory.CreateLogger("GameDetails").LogError(ex, "Failed to load game info");
 errorMessage = "Failed to load game: " + ex.Message;
 }
 finally
 {
 isLoading = false;
 StateHasChanged();
 }
 }
}