@using MattEland.Jaimes.ServiceDefinitions.Responses
@using MattEland.Jaimes.Web.Components.Helpers
@using MattEland.Jaimes.Web.Components.Pages
@using MudBlazor

@if (!string.IsNullOrWhiteSpace(Text))
{
    <MudChat ChatPosition="ChatBubblePosition.Start"
             Variant="Variant.Filled"
             Color="@(Highlighted ? Color.Info : Color)">
        @if (IsFirstParagraph)
        {
            <MudChatHeader Name="Game Master"/>
        }
        <MudChatBubble>
            @((MarkupString)ChatHelpers.RenderMarkdown(Text))
        </MudChatBubble>
        @if (IsLastParagraph)
        {
            <MudChatFooter Class="feedback-footer">
                <MessageIndicators
                    Feedback="@Feedback"
                    Metrics="@Metrics"
                    ToolCallCount="@(ToolCalls?.Count ?? 0)"
                    ToolCalls="@ToolCalls"
                    ReadOnly="@ReadOnly"
                    ShowFeedbackButtons="true"
                    MessageId="@MessageId"
                    OnToolCallsClick="OnToolCallsClick"
                    OnFeedbackClick="OnFeedbackClick"
                    OnMetricsClick="OnMetricsClick" />
            </MudChatFooter>
        }
    </MudChat>
}

@code {
    [Parameter]
    public required string Text { get; set; }

    [Parameter]
    public Color Color { get; set; } = Color.Default;

    [Parameter]
    public bool Highlighted { get; set; }
    
    [Parameter]
    public int? MessageId { get; set; }

    [Parameter]
    public bool IsFirstParagraph { get; set; }

    [Parameter]
    public bool IsLastParagraph { get; set; }
    
    [Parameter]
    public bool ReadOnly { get; set; }

    [Parameter]
    public List<MessageToolCallResponse>? ToolCalls { get; set; }

    [Parameter]
    public List<MessageEvaluationMetricResponse>? Metrics { get; set; }

    [Parameter]
    public MessageFeedbackResponse? Feedback { get; set; }

    [Parameter]
    public EventCallback<int> OnToolCallsClick { get; set; }

    [Parameter]
    public EventCallback<(int MessageId, bool IsPositive)> OnFeedbackClick { get; set; }

    [Parameter]
    public EventCallback<int> OnMetricsClick { get; set; }
}

